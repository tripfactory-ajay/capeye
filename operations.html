<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operations | Capeye Auto Capital</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Capeye Design System -->
    <link rel="stylesheet" href="./css/capeye-system.css">
    
    <style>
        /* Operations-specific styles */
        .ops-grid {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 24px;
        }
        
        @media (max-width: 1024px) {
            .ops-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .sidebar-card {
            background: var(--cy-bg-secondary);
            border: 1px solid var(--cy-border);
            border-radius: var(--cy-radius-xl);
            padding: 20px;
            margin-bottom: 16px;
        }
        
        .sidebar-title {
            font-size: 12px;
            font-weight: 700;
            color: var(--cy-text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 16px;
        }
        
        .dept-list {
            space-y: 8px;
        }
        
        .dept-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: var(--cy-radius-md);
            cursor: pointer;
            transition: all var(--cy-transition-fast);
            border: 1px solid transparent;
        }
        
        .dept-item:hover, .dept-item.active {
            background: var(--cy-bg-tertiary);
            border-color: var(--cy-border);
        }
        
        .dept-icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }
        
        .dept-info {
            flex: 1;
        }
        
        .dept-name {
            font-weight: 600;
            color: var(--cy-text-primary);
            font-size: 13px;
        }
        
        .dept-count {
            font-size: 11px;
            color: var(--cy-text-muted);
        }
        
        .timeline {
            position: relative;
            padding-left: 24px;
        }
        
        .timeline::before {
            content: '';
            position: absolute;
            left: 7px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--cy-border);
        }
        
        .timeline-item {
            position: relative;
            padding-bottom: 24px;
        }
        
        .timeline-item:last-child {
            padding-bottom: 0;
        }
        
        .timeline-dot {
            position: absolute;
            left: -24px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--cy-bg-secondary);
            border: 2px solid var(--cy-accent-blue);
        }
        
        .timeline-content {
            background: var(--cy-bg-tertiary);
            border: 1px solid var(--cy-border);
            border-radius: var(--cy-radius-lg);
            padding: 16px;
        }
        
        .timeline-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }
        
        .timeline-title {
            font-weight: 600;
            color: var(--cy-text-primary);
            font-size: 14px;
        }
        
        .timeline-time {
            font-size: 11px;
            color: var(--cy-text-muted);
        }
        
        .timeline-desc {
            font-size: 13px;
            color: var(--cy-text-secondary);
        }
        
        .staff-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
        }
        
        .staff-card {
            background: var(--cy-bg-tertiary);
            border: 1px solid var(--cy-border);
            border-radius: var(--cy-radius-lg);
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all var(--cy-transition-fast);
        }
        
        .staff-card:hover {
            border-color: var(--cy-border-hover);
            transform: translateY(-2px);
        }
        
        .staff-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--cy-accent-blue), var(--cy-accent-purple));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 16px;
        }
        
        .staff-info {
            flex: 1;
        }
        
        .staff-name {
            font-weight: 600;
            color: var(--cy-text-primary);
            font-size: 14px;
        }
        
        .staff-role {
            font-size: 12px;
            color: var(--cy-text-muted);
        }
        
        .staff-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--cy-accent-green);
        }
        
        .staff-status.busy {
            background: var(--cy-accent-orange);
        }
        
        .staff-status.offline {
            background: var(--cy-text-muted);
        }
        
        .task-list {
            space-y: 12px;
        }
        
        .task-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px;
            background: var(--cy-bg-tertiary);
            border: 1px solid var(--cy-border);
            border-radius: var(--cy-radius-lg);
            margin-bottom: 12px;
        }
        
        .task-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid var(--cy-border);
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--cy-transition-fast);
        }
        
        .task-checkbox:hover {
            border-color: var(--cy-accent-blue);
        }
        
        .task-checkbox.checked {
            background: var(--cy-accent-blue);
            border-color: var(--cy-accent-blue);
        }
        
        .task-content {
            flex: 1;
        }
        
        .task-title {
            font-weight: 500;
            color: var(--cy-text-primary);
            font-size: 14px;
            margin-bottom: 2px;
        }
        
        .task-title.completed {
            text-decoration: line-through;
            color: var(--cy-text-muted);
        }
        
        .task-meta {
            font-size: 12px;
            color: var(--cy-text-muted);
        }
        
        .priority-high {
            color: var(--cy-accent-red);
        }
        
        .priority-medium {
            color: var(--cy-accent-orange);
        }
        
        .priority-low {
            color: var(--cy-accent-green);
        }
        
        .schedule-grid {
            display: grid;
            grid-template-columns: 80px 1fr;
            gap: 16px;
        }
        
        .time-slot {
            text-align: right;
            font-size: 12px;
            color: var(--cy-text-muted);
            font-weight: 500;
            padding-top: 12px;
        }
        
        .slot-events {
            border-left: 2px solid var(--cy-border);
            padding-left: 16px;
            padding-bottom: 16px;
        }
        
        .event-card {
            background: var(--cy-bg-tertiary);
            border: 1px solid var(--cy-border);
            border-radius: var(--cy-radius-md);
            padding: 12px;
            margin-bottom: 8px;
            border-left: 3px solid var(--cy-accent-blue);
        }
        
        .event-title {
            font-weight: 600;
            color: var(--cy-text-primary);
            font-size: 13px;
            margin-bottom: 4px;
        }
        
        .event-meta {
            font-size: 11px;
            color: var(--cy-text-muted);
        }
        
        .stats-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }
        
        @media (max-width: 768px) {
            .stats-row {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .stat-mini {
            background: var(--cy-bg-tertiary);
            border: 1px solid var(--cy-border);
            border-radius: var(--cy-radius-lg);
            padding: 16px;
            text-align: center;
        }
        
        .stat-mini-value {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 24px;
            font-weight: 700;
            color: var(--cy-text-primary);
            margin-bottom: 4px;
        }
        
        .stat-mini-label {
            font-size: 11px;
            color: var(--cy-text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
    </style>
</head>
<body>
    <!-- Background Effects -->
    <div class="cy-bg-grid"></div>
    <div class="cy-ambient-glow" style="top: -200px; right: -200px;"></div>
    <div class="cy-ambient-glow-red" style="bottom: -100px; left: -100px;"></div>

    <!-- Header -->
    <header class="cy-header">
        <div class="cy-header-content">
            <div class="cy-flex cy-items-center" style="gap: 32px;">
                <a href="./index.html" class="cy-brand">
                    <div class="cy-logo">AC</div>
                    <div class="cy-brand-text">
                        <h1>CAPEYE</h1>
                        <span>Auto Capital Intelligence</span>
                    </div>
                </a>
                
                <nav class="cy-nav">
                    <a href="./index.html" class="cy-nav-link">
                        <i class="fas fa-home"></i> Dashboard
                    </a>
                    <a href="./operations.html" class="cy-nav-link active">
                        <i class="fas fa-cogs"></i> Operations
                    </a>
                    <a href="./inventory.html" class="cy-nav-link">
                        <i class="fas fa-car"></i> Inventory
                    </a>
                    <a href="./workflow.html" class="cy-nav-link">
                        <i class="fas fa-tasks"></i> Workflow
                    </a>
                    <a href="./analytics.html" class="cy-nav-link">
                        <i class="fas fa-chart-bar"></i> Analytics
                    </a>
                </nav>
            </div>
            
            <div class="cy-flex cy-items-center" style="gap: 16px;">
                <div class="cy-dropdown">
                    <button class="cy-dropdown-btn">
                        <i class="fas fa-toolbox"></i>
                        Tools
                        <i class="fas fa-chevron-down" style="font-size: 10px;"></i>
                    </button>
                    <div class="cy-dropdown-menu">
                        <a href="https://myclickdealer.co.uk" target="_blank" class="cy-dropdown-item">
                            <div class="cy-dropdown-icon" style="color: var(--cy-accent-blue);">
                                <i class="fas fa-mouse-pointer"></i>
                            </div>
                            <div>
                                <div class="tool-title">Click Dealer</div>
                                <div class="tool-desc">DMS & Stock</div>
                            </div>
                        </a>
                        <a href="https://autocapital.co.uk" target="_blank" class="cy-dropdown-item">
                            <div class="cy-dropdown-icon" style="color: var(--cy-accent-green);">
                                <i class="fas fa-building"></i>
                            </div>
                            <div>
                                <div class="tool-title">Auto Capital</div>
                                <div class="tool-desc">Website</div>
                            </div>
                        </a>
                        <a href="https://www.gov.uk/get-vehicle-information-from-dvla" target="_blank" class="cy-dropdown-item">
                            <div class="cy-dropdown-icon" style="color: var(--cy-accent-orange);">
                                <i class="fas fa-search"></i>
                            </div>
                            <div>
                                <div class="tool-title">DVLA Check</div>
                                <div class="tool-desc">Vehicle Info</div>
                            </div>
                        </a>
                        <a href="https://www.hpicheck.com" target="_blank" class="cy-dropdown-item">
                            <div class="cy-dropdown-icon" style="color: #ec4899;">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div>
                                <div class="tool-title">HPI Check</div>
                                <div class="tool-desc">History</div>
                            </div>
                        </a>
                    </div>
                </div>
                
                <button onclick="logout()" class="cy-nav-link" style="color: var(--cy-accent-red);">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="cy-container">
        
        <!-- Page Header -->
        <div class="cy-section">
            <div class="cy-flex cy-justify-between cy-items-end">
                <div>
                    <h2 class="cy-font-display" style="font-size: 32px; font-weight: 700; margin-bottom: 8px;">
                        Operations <span style="color: var(--cy-accent-blue);">Centre</span>
                    </h2>
                    <p class="cy-text-secondary">Department management, staff scheduling, and daily operations</p>
                </div>
                <div class="cy-live-badge">
                    <div class="cy-live-dot"></div>
                    <span>Live</span>
                </div>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="stats-row">
            <div class="stat-mini">
                <div class="stat-mini-value" id="staffOnline">0</div>
                <div class="stat-mini-label">Staff Online</div>
            </div>
            <div class="stat-mini">
                <div class="stat-mini-value" id="activeTasks">0</div>
                <div class="stat-mini-label">Active Tasks</div>
            </div>
            <div class="stat-mini">
                <div class="stat-mini-value" id="vehiclesToday">0</div>
                <div class="stat-mini-label">Vehicles Today</div>
            </div>
            <div class="stat-mini">
                <div class="stat-mini-value" id="completionRate">0%</div>
                <div class="stat-mini-label">Completion</div>
            </div>
        </div>

        <!-- Main Operations Grid -->
        <div class="ops-grid">
            <!-- Sidebar -->
            <div>
                <!-- Departments -->
                <div class="sidebar-card">
                    <div class="sidebar-title">Departments</div>
                    <div class="dept-list" id="departmentList">
                        <!-- Injected by JS -->
                    </div>
                </div>

                <!-- Today's Schedule -->
                <div class="sidebar-card">
                    <div class="sidebar-title">My Schedule</div>
                    <div class="timeline" id="todaySchedule">
                        <!-- Injected by JS -->
                    </div>
                </div>
            </div>

            <!-- Main Content Area -->
            <div>
                <!-- Staff Overview -->
                <div class="cy-card" style="margin-bottom: 24px;">
                    <div class="cy-section-header">
                        <div class="cy-section-title">
                            <i class="fas fa-users" style="color: var(--cy-accent-blue);"></i>
                            Staff Overview
                        </div>
                        <div class="cy-flex cy-gap-sm">
                            <button class="cy-btn cy-btn-secondary cy-btn-sm" onclick="filterStaff('all')">All</button>
                            <button class="cy-btn cy-btn-secondary cy-btn-sm" onclick="filterStaff('online')">Online</button>
                            <button class="cy-btn cy-btn-secondary cy-btn-sm" onclick="filterStaff('busy')">Busy</button>
                        </div>
                    </div>
                    <div class="staff-grid" id="staffGrid">
                        <!-- Injected by JS -->
                    </div>
                </div>

                <!-- Task Management -->
                <div class="cy-card" style="margin-bottom: 24px;">
                    <div class="cy-section-header">
                        <div class="cy-section-title">
                            <i class="fas fa-clipboard-check" style="color: var(--cy-accent-green);"></i>
                            Priority Tasks
                        </div>
                        <button class="cy-btn cy-btn-primary cy-btn-sm" onclick="addTask()">
                            <i class="fas fa-plus"></i> Add Task
                        </button>
                    </div>
                    <div class="task-list" id="taskList">
                        <!-- Injected by JS -->
                    </div>
                </div>

                <!-- Department Schedule -->
                <div class="cy-card">
                    <div class="cy-section-header">
                        <div class="cy-section-title">
                            <i class="fas fa-calendar-alt" style="color: var(--cy-accent-purple);"></i>
                            Department Schedule
                        </div>
                        <div class="cy-flex cy-gap-sm">
                            <button class="cy-btn cy-btn-secondary cy-btn-sm" onclick="changeScheduleView('day')">Day</button>
                            <button class="cy-btn cy-btn-secondary cy-btn-sm" onclick="changeScheduleView('week')">Week</button>
                        </div>
                    </div>
                    <div class="schedule-grid" id="scheduleGrid">
                        <!-- Injected by JS -->
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="./js/capeye-core.js"></script>
    <script>
        // Department data
        const departments = [
            { id: 'sales', name: 'Sales', icon: 'fa-handshake', color: '#3b82f6', count: 0 },
            { id: 'workshop', name: 'Workshop', icon: 'fa-wrench', color: '#f59e0b', count: 0 },
            { id: 'bodyshop', name: 'Bodyshop', icon: 'fa-spray-can', color: '#8b5cf6', count: 0 },
            { id: 'valeting', name: 'Valeting', icon: 'fa-sparkles', color: '#10b981', count: 0 },
            { id: 'accounts', name: 'Accounts', icon: 'fa-calculator', color: '#64748b', count: 0 },
            { id: 'management', name: 'Management', icon: 'fa-user-tie', color: '#6366f1', count: 0 }
        ];

        // Staff data
        const staffData = [
            { name: 'Keith Hardy', role: 'General Manager', dept: 'management', status: 'online', initials: 'KH' },
            { name: 'Ibrahim Ata', role: 'Sales Manager', dept: 'sales', status: 'online', initials: 'IA' },
            { name: 'Ali Amood', role: 'Workshop Lead', dept: 'workshop', status: 'busy', initials: 'AA' },
            { name: 'Morteza Rahamian', role: 'Technician', dept: 'workshop', status: 'online', initials: 'MR' },
            { name: 'Marcin Kiljan', role: 'Technician', dept: 'workshop', status: 'busy', initials: 'MK' },
            { name: 'Sia Vajihi', role: 'Technician', dept: 'workshop', status: 'offline', initials: 'SV' },
            { name: 'Iman Zarien', role: 'Technician', dept: 'workshop', status: 'online', initials: 'IZ' },
            { name: 'Stash', role: 'Bodyshop', dept: 'bodyshop', status: 'online', initials: 'ST' }
        ];

        // Tasks data
        let tasks = [
            { id: 1, title: 'Complete PDI on Ford Transit', priority: 'high', dept: 'workshop', completed: false, time: '2 hours' },
            { id: 2, title: 'Review pricing for Q2', priority: 'medium', dept: 'management', completed: false, time: 'Today' },
            { id: 3, title: 'Customer handover - Mr. Smith', priority: 'high', dept: 'sales', completed: true, time: '10:00 AM' },
            { id: 4, title: 'Valeting - 3 vehicles', priority: 'low', dept: 'valeting', completed: false, time: 'This afternoon' }
        ];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadDepartmentStats();
            loadStaff();
            loadTasks();
            loadSchedule();
            updateQuickStats();
        });

        function loadDepartmentStats() {
            const vehicles = JSON.parse(localStorage.getItem('capeye_vehicles') || '[]');
            
            // Count vehicles per department based on workflow stage
            departments.forEach(dept => {
                dept.count = vehicles.filter(v => {
                    const stage = v.workflowStage || 1;
                    if (dept.id === 'sales' && [1, 9, 10].includes(stage)) return true;
                    if (dept.id === 'workshop' && [5, 6, 8].includes(stage)) return true;
                    if (dept.id === 'bodyshop' && [2, 3].includes(stage)) return true;
                    if (dept.id === 'valeting' && stage === 7) return true;
                    if (dept.id === 'accounts' && [4, 11].includes(stage)) return true;
                    if (dept.id === 'management' && stage === 12) return true;
                    return false;
                }).length;
            });

            const container = document.getElementById('departmentList');
            container.innerHTML = departments.map(dept => `
                <div class="dept-item" onclick="filterByDept('${dept.id}')">
                    <div class="dept-icon" style="background: ${dept.color}20; color: ${dept.color};">
                        <i class="fas ${dept.icon}"></i>
                    </div>
                    <div class="dept-info">
                        <div class="dept-name">${dept.name}</div>
                        <div class="dept-count">${dept.count} vehicles</div>
                    </div>
                    <i class="fas fa-chevron-right" style="color: var(--cy-text-muted); font-size: 12px;"></i>
                </div>
            `).join('');
        }

        function loadStaff(filter = 'all') {
            let filtered = staffData;
            if (filter === 'online') filtered = staffData.filter(s => s.status === 'online');
            if (filter === 'busy') filtered = staffData.filter(s => s.status === 'busy');

            const container = document.getElementById('staffGrid');
            container.innerHTML = filtered.map(staff => `
                <div class="staff-card">
                    <div class="staff-avatar">${staff.initials}</div>
                    <div class="staff-info">
                        <div class="staff-name">${staff.name}</div>
                        <div class="staff-role">${staff.role}</div>
                    </div>
                    <div class="staff-status ${staff.status}" title="${staff.status}"></div>
                </div>
            `).join('');
        }

        function filterStaff(type) {
            loadStaff(type);
        }

        function loadTasks() {
            const container = document.getElementById('taskList');
            container.innerHTML = tasks.map(task => `
                <div class="task-item">
                    <div class="task-checkbox ${task.completed ? 'checked' : ''}" onclick="toggleTask(${task.id})">
                        ${task.completed ? '<i class="fas fa-check" style="color: white; font-size: 12px;"></i>' : ''}
                    </div>
                    <div class="task-content">
                        <div class="task-title ${task.completed ? 'completed' : ''}">${task.title}</div>
                        <div class="task-meta">
                            <span class="priority-${task.priority}">${task.priority}</span> • 
                            ${task.dept} • 
                            ${task.time}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function toggleTask(id) {
            const task = tasks.find(t => t.id === id);
            if (task) {
                task.completed = !task.completed;
                loadTasks();
                updateQuickStats();
            }
        }

        function addTask() {
            const title = prompt('Enter task title:');
            if (title) {
                tasks.push({
                    id: tasks.length + 1,
                    title: title,
                    priority: 'medium',
                    dept: 'general',
                    completed: false,
                    time: 'Now'
                });
                loadTasks();
                updateQuickStats();
            }
        }

        function loadSchedule() {
            const schedule = [
                { time: '09:00', events: [{ title: 'Morning Briefing', dept: 'All', duration: '30 min' }] },
                { time: '10:00', events: [{ title: 'PDI Check - Ford Transit', dept: 'Workshop', duration: '1 hour' }] },
                { time: '11:30', events: [{ title: 'Customer Handover', dept: 'Sales', duration: '45 min' }] },
                { time: '13:00', events: [{ title: 'Lunch Break', dept: 'All', duration: '1 hour' }] },
                { time: '14:00', events: [{ title: 'Valeting - 3 vehicles', dept: 'Valeting', duration: '2 hours' }] },
                { time: '16:00', events: [{ title: 'Management Review', dept: 'Management', duration: '1 hour' }] }
            ];

            const container = document.getElementById('scheduleGrid');
            container.innerHTML = schedule.map(slot => `
                <div class="time-slot">${slot.time}</div>
                <div class="slot-events">
                    ${slot.events.map(event => `
                        <div class="event-card">
                            <div class="event-title">${event.title}</div>
                            <div class="event-meta">${event.dept} • ${event.duration}</div>
                        </div>
                    `).join('')}
                </div>
            `).join('');
        }

        function updateQuickStats() {
            const online = staffData.filter(s => s.status === 'online').length;
            const active = tasks.filter(t => !t.completed).length;
            const completed = tasks.filter(t => t.completed).length;
            const rate = tasks.length > 0 ? Math.round((completed / tasks.length) * 100) : 0;

            document.getElementById('staffOnline').textContent = online;
            document.getElementById('activeTasks').textContent = active;
            document.getElementById('vehiclesToday').textContent = '12'; // Mock data
            document.getElementById('completionRate').textContent = rate + '%';
        }

        function filterByDept(deptId) {
            // Highlight selected department
            document.querySelectorAll('.dept-item').forEach(el => el.classList.remove('active'));
            event.currentTarget.classList.add('active');
            
            // Filter staff and tasks by department
            const deptName = departments.find(d => d.id === deptId)?.name;
            Capeye.notify(`Filtered by ${deptName}`, 'info');
        }

        function changeScheduleView(view) {
            Capeye.notify(`Switched to ${view} view`, 'info');
        }

        // Refresh function for auto-refresh
        window.refreshData = function() {
            loadDepartmentStats();
            updateQuickStats();
        };
    </script>
</body>
</html>
